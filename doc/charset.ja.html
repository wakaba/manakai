<?xml version="1.0" encoding="iso-2022-jp"?>
<?xml-stylesheet href="/s/simpledoc.css" type="text/css" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
   "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xml:lang="ja" xmlns="http://www.w3.org/1999/xhtml">
<head>
<title xml:lang="en">Message::* Perl modules の文字コードの扱い</title>
<link rel="index" href="./" />
<link rel="prev" href="introduction" title="Message::* Perl Modules の紹介" />
<link rel="stylesheet" href="/s/simpledoc.css" type="text/css" />
<link rev="made" href="mailto:w@suika.fam.cx" />
<link rel="copyright" href="/c/pd" title="Public Domain." />
<meta name="author" content="若葉" />
<meta name="keywords" content="Perl, module, pm, Message, 文字コード, フック関数, charset, 符号化文字集合, 文字符号化方式, CCS, CES" />
</head>
<body>
<h1><a href="introduction">Message::* Perl modules</a> の文字コードの扱い</h1>

<ul>
	<li><a href="#ja">手っ取り早く日本語が使えるようにする方法</a></li>
	<li><a href="#hook">フック関数っぽいものの説明</a></li>
	<li><a href="#future">将来計画</a></li>
</ul>

<h2 id="ja">手っ取り早く日本語が使えるようにする方法</h2>

<p>日本語文字コード変換に良く使われる、
<a href="http://srekcah.org/jcode/">jcode.pl</a> や 
<a href="http://openlab.ring.gr.jp/Jcode/">Jcode.pm</a>,
<a href="http://bw-www.ie.u-ryukyu.ac.jp/~kono/software.html">NKF.pm</a>
などを使うための定義モジュールを用意しています。これを次の例のように
<code>use</code> するだけで使えます。</p>

<pre class="example perl">
<span class="comment">## どちらか好きな方をどうぞ。</span>
use Message::MIME::Charset::Jcode 'Jcode';	## 'Jcode.pm' と書いても良い。
use Message::MIME::Charset::Jcode 'jcode.pl';
</pre>

<p>jcode.pl や Jcode.pm などは、自動的に 
<code>require</code>/<code>use</code> されます。</p>

<p>ちなみに、複数回 Message::MIME::Charset::Jcode 
を読み込んだ場合には最後の定義が有効になります。また、
(当然といえば当然ですが) そのモジュールで利用可能な charset
のみ定義されます。ですから、上の例の通りの順番で書いておくことで、
<code class="mime-charset">UTF-8</code> は Jcode.pm で、それ以外の場合は
jcode.pl で変換が行われます。</p>

<p>なお、内部文字コード (メソッドなどで値を取り出した時の符号化方式)
は、変換モジュールの内部コードまたは日本語 EUC になります。
(jcode.pl や Jcode.pm では日本語 EUC です。) これを変更するには、
<code>$Message::MIME::Charset::Jcode::CODE{internal}</code>
を <code>'sjis'</code> や <code>'jis'</code> (7ビット ISO/IEC 2022)
などにして下さい。</p>

<h2 id="hook">Charset の定義</h2>

<p>既定の状態では、本文や <code class="bnf rfc822">quoted-string</code>
などの部分について、文字コードに関係する変換処理は行われません。
Perl のファイル入出力などがそうであるように、単なる8ビットのオクテット列として扱います。</p>

<p>文字コードの変換処理 (メッセージの符号化文字集合から
script 内部の符号化文字集合への変換と、その逆)
を定義するには、 
<code class="perl">Message::MIME::Charset::make_charset</code>
を使います。利用例は Message::MIME::Charset::Jcode
を見て下さい。</p>

<p><code class="perl">*default</code> は特別な charset
で、 MIME などで charset が指定されていない、
<code class="bnf rfc822">quoted-string</code>
の変換処理を定義します。 (なお、一般に charset 名は、
Message::* 各モジュールでは小文字に正規化した状態で処理しますから、こうした
charset 定義は小文字で行います。)</p>

<p>この charset 
定義は、当然、当該処理が呼び出される前に行っておく必要があります。
<samp class="perl">Message::Entity-&gt;parse</samp> などする前に
定義しておくと良いでしょう。</p>

<p>Charset 定義の name_minimumizer 属性は、名前最小化の関数を指定します。
MIME によると charset 名は、使用されている文字の範囲の最小公倍数的なものにする必要があります。
(例えば、基本ラテン文字のみからなる 
<code class="mime-charset">ISO-2022-JP</code> は、名前を最小化して
<code class="mime-charset">US-ASCII</code> としなければなりません。)</p>

<p>なお、 
<code class="mime-charset">ISO-2022-JP</code> など幾つかの charset
用には Message::MIME::Charset で組み込み定義されていますので、改めて指定する必要はありません。</p>

<h2 id="future">将来計画</h2>

<ul>
<li>Perl 5.8 対応
	<ul>
		<li>UTF-8 旗が付いた文字列を正しく扱えるようにする。</li>
		<li>Encode モジュール用の定義モジュールの作成。</li>
	</ul>
</li>
</ul>

<div class="navigation">
[<a href="/" title="このサーバーの首頁">/</a>
<a href="/map" title="このサーバーの案内" rel="index">地図</a>
<a href="/search/" title="このサーバーの検索">検索</a>]

[<a href="introduction" title="Message::* Perl Modules の紹介">紹介</a>]

<a href="http://validator.w3.org/check/referer" xml:lang="en"><img
        src="http://www.w3.org/Icons/valid-xhtml11" id="w3c-html"
        alt="Valid XHTML 1.1!" style="height: 31px; width: 88px" /></a>
<a href="http://jigsaw.w3.org/css-validator/validator?uri=http://suika.fam.cx/~wakaba/Message-pm/charset.ja.html" xml:lang="en">
  <img style="width: 88px; height: 31px" id="w3c-css"
       src="http://jigsaw.w3.org/css-validator/images/vcss" 
       alt="Valid CSS!" /></a>
</div>
<div class="update">$Date: 2002/07/13 11:51:56 $</div>
<ul class="myuri">
<li>&lt;URL:<a href="http://suika.fam.cx/~wakaba/Message-pm/introduction">http://suika.fam.cx/~wakaba/Message-pm/introduction</a>&gt;</li>
<li>&lt;CVS:<a href="http://suika.fam.cx/gate/cvs/perl/web/Message-pm/">suika.fam.cx:/home/cvs/perl/web/Message-pm/</a>&gt;</li>
</ul>
</body></html>
